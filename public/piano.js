// Generated by CoffeeScript 1.6.3
(function() {
  var clicks, keypress, notes, scale, server, socket;

  socket = io.connect();

  scale = ['A2', 'B2', 'C3', 'D3', 'E3', 'F3', 'G3', 'A3', 'B3', 'C4', 'D4', 'E4', 'F4', 'G4', 'A4', 'B4', 'C5'];

  clicks = $("#piano").asEventStream("click", ".clickable").doAction(".preventDefault").map(function(e) {
    return $(e.currentTarget).attr("data-note");
  });

  keypress = $(document).asEventStream("keypress").map(".keyCode").filter(function(code) {
    return code >= 49 && code <= 56;
  }).map(function(code) {
    return scale[code - 47];
  });

  server = Bacon.fromEventTarget(socket, 'note').filter(function(note) {
    return $.inArray(note, scale);
  });

  notes = clicks.merge(keypress).doAction(function(data) {
    return socket.emit("note", data);
  }).merge(server).doAction(player).onValue(function(data) {
    return console.log("Playing:", data);
  });

  keypress.merge(server).map(function(key) {
    return $("[data-note='" + key + "']");
  }).doAction(function(el) {
    return el.addClass("active");
  }).delay(200).onValue(function(el) {
    return el.removeClass("active");
  });

}).call(this);
